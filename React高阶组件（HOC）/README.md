### Reacté«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰

é¦–å‘åœ°å€ï¼š[94æ¢¦æƒ³å®¶](http://94dreamer.com/) å’Œ [githubä»“åº“](https://github.com/94dreamer/)

### ä¸€ã€ä»€ä¹ˆæ˜¯Reacté«˜é˜¶ç»„ä»¶ï¼Ÿ
> å¬èµ·æ¥å¾ˆé«˜å¤§ä¸Šï¼Œå…¶å®ä¹Ÿå°±æ˜¯å‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ï¼Œè¿”å›ä¸€ä¸ªæ–°ç»„ä»¶ã€‚

å¦‚æœæˆ‘ä»¬ç”¨è¿‡`react-redux`ï¼Œå°±ä¸€å®šçœ‹è¿‡ç±»ä¼¼è¿™æ®µä»£ç  `connect(mapDispatchToProps,mapStateToProps)(TabPage)`ã€‚è¿™å°±æ˜¯reactçš„HOCï¼ŒæŠŠç»„ä»¶å½“ä½œå‚æ•°ä¼ å…¥ï¼Œåœ¨å†…éƒ¨ç»è¿‡å¤„ç†å’Œé¢å¤–å°è£…ï¼Œè¾¾åˆ°é¢å¤–æ·»åŠ è¿™éƒ¨åˆ†åŠŸèƒ½ä»£ç å¤ç”¨çš„æ•ˆæœã€‚ä»–çš„å‰èº«å…¶å®æ˜¯ç”¨ES5åˆ›å»ºç»„ä»¶æ—¶å¯ç”¨çš„`mixin`æ–¹æ³•ï¼Œä½†æ˜¯åœ¨reactç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ES6è¯­æ³•åˆ›å»ºç»„ä»¶æ—¶ï¼Œè®¤ä¸º`mixin`æ˜¯åæ¨¡å¼ï¼Œå½±å“äº†reactæ¶æ„ç»„ä»¶çš„å°è£…ç¨³å®šæ€§ï¼Œå¢åŠ äº†ä¸å¯æ§çš„å¤æ‚åº¦ï¼Œé€æ¸è¢«`HOC`æ‰€æ›¿ä»£ã€‚

æ­¤æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡ç”¨é€šä¿—çš„è¯­è¨€æè¿°ä¸€ä¸‹é«˜é˜¶ç»„ä»¶ï¼ˆhigher-order componentï¼‰ï¼Œå½“reactç»„ä»¶è¢«åŒ…è£¹ï¼ˆwrappedï¼‰æ—¶ï¼Œé«˜é˜¶ç»„ä»¶ä¼šè¿”å›ä¸€ä¸ªå¢å¼ºç‰ˆï¼ˆenhancedï¼‰çš„reactç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ç”¨è¿‡æŸ¯é‡ŒåŒ–ï¼ˆcurryï¼‰é€æ­¥ç¡®å®šé«˜é˜¶ç»„ä»¶çš„å¢åŠ åŠŸèƒ½ç‰¹æ€§ï¼Œå¹¶æŠŠè¿™äº›ç‰¹æ€§åŒ…è£¹ç»™å‚æ•°ç»„ä»¶ã€‚å®ƒå¯ä»¥åšä»€ä¹ˆï¼Ÿé«˜é˜¶ç»„ä»¶è®©æˆ‘ä»¬çš„åŠŸèƒ½æ€§ä»£ç æ›´å…·æœ‰å¤ç”¨æ€§ã€é€»è¾‘æ€§ä¸æŠ½è±¡ç‰¹æ€§ï¼Œå®ƒå¯ä»¥å¯¹`render`æ–¹æ³•åšåŠ«æŒï¼Œå¯ä»¥æ§åˆ¶`props`å’Œ`state`ã€‚

è¿™å¹¶ä¸æ˜¯è¯´æˆ‘ä»¬åœ¨æ„å»ºreacté¡¹ç›®æ²¡æœ‰é«˜é˜¶ç»„ä»¶å°±ä¸èƒ½æ´»äº†ğŸ˜‚ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨UIç»„ä»¶æ¯”è¾ƒå¤šè€Œå®¹å™¨ç»„ä»¶æ¯”è¾ƒå°‘ï¼Œäº¤äº’å¤ç”¨æ€§è¾ƒä½çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥ä¸ç”¨åˆ°é«˜é˜¶ç»„ä»¶çš„ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€æ—¦æŒæ¡reactçš„é«˜é˜¶ç»„ä»¶ï¼Œå°±èƒ½æå¤§æé«˜ä»£ç å¤ç”¨ç‡ï¼Œå’Œé€»è¾‘ä»£ç çš„å¯ç®¡ç†åº¦ï¼Œæ˜¯æˆ‘ä»¬çš„ä»£ç æ›´åŠ ä¼˜é›…ğŸ˜˜ã€‚

æˆ‘ä»¬å†ç”¨ä»£ç æ¥è¡¨è¿°ä¸€ä¸‹é«˜é˜¶ç»„ä»¶

```
// ç®€å•ä¸€ç‚¹çš„ï¼Œä¼ å…¥ç»„ä»¶ï¼Œè¿”å›é¢å®šçš„å°è£…ï¼š
const newComponent = hiderOderFunction(OldComponent);
// æŸ¯é‡ŒåŒ–ç¨‹åº¦é«˜ä¸€äº›çš„,é€šè¿‡ä¸¤æ¬¡ä¼ å‚è¿›ä¸€æ­¥ç¡®å®šå’Œç¼©å°é«˜é˜¶ç»„ä»¶åŠŸèƒ½ï¼š
const newComponent = hiderOderFunction(params)(OldComponent);
```

### äºŒã€Reacté«˜é˜¶ç»„ä»¶çš„å®ç°

å¦‚æœæˆ‘ä»¬å­¦è¿‡è®¾è®¡æ¨¡å¼ï¼ŒåŒæ—¶ç”¨äº†`HOC`ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°†åè€…ä¸è£…é¥°è€…æ¨¡å¼è”ç³»èµ·æ¥ã€‚æˆ‘ä»¬é€šè¿‡ç»„åˆçš„æ–¹å¼åˆ°è¾¾å¾ˆé«˜çµæ´»åº¦çš„è£…é¥°æ­é…ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ç§æ€ç»´å¸¦åˆ°æ¥ä¸‹æ¥çš„`HOC`å®ç°ã€‚

å®ç°çš„é«˜é˜¶ç»„ä»¶çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼š

- å±æ€§ä»£ç†ã€‚å‡½æ•°é€šè¿‡è¿”å›åŒ…è£¹åŸç»„ä»¶æ¥æ·»åŠ é¢å¤–åŠŸèƒ½ã€‚
- åå‘ç»§æ‰¿ã€‚å‡½æ•°é€šè¿‡è¿”å›ç»§æ‰¿åŸç»„ä»¶æ¥æ§åˆ¶renderã€‚

1. å±æ€§ä»£ç†

å±æ€§ä»£ç†æ˜¯å¸¸è§é«˜é˜¶ç»„ä»¶çš„å®ç°æ–¹å¼ã€‚

```
//æˆ‘ä»¬æ¥å†™ä¸€ä¸ªæœ€ç®€å•çš„
const MyContainer = (WrappedComponent) =>class extends Components{
	render(){
		const newProps={
			text:'newText',
		}
		return <WrappedComponent {...this.props} {...newProps} />
	}
}
```

å°±è¿™ä¹ˆç®€å•æˆ‘ä»¬å®ç°äº†å¯¹åŸç»„ä»¶propsçš„æ·»åŠ ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨`MyContainer`å†…æ·»åŠ å„ç§ç”Ÿå‘½å‘¨æœŸå’Œè‡ªå®šä¹‰æ–¹æ³•å®ç°å¯¹`render`æ—¶`return`ç»„ä»¶çš„å„ç§æ§åˆ¶ã€‚

2. åå‘ç»§æ‰¿

åå‘ç»§æ‰¿æ˜¯é€šè¿‡classç»§æ‰¿ç‰¹æ€§æ¥å®ç°é«˜é˜¶ç»„ä»¶çš„ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬é€šè¿‡ç®€å•çš„ä»£ç æ¥ç†è§£ä¸€ä¸‹ï¼š

```
const MyContainer = (WrappedComponent) = > class extends WappedComponent {
	render (){
		return super.render();
	}
}
```
è¿™ç§æ–¹æ³•å’Œå±æ€§ä»£ç†ä¸å¤ªä¸€æ ·ï¼Œå®ƒé€šè¿‡ç»§æ‰¿WrappedComponentæ¥å®ç°ï¼Œæ–¹æ³•å¯ä»¥é€šè¿‡superæ¥é¡ºåºè°ƒç”¨ã€‚åœ¨ç»§æ‰¿æ–¹æ³•ä¸­ï¼Œé«˜é˜¶ç»„ä»¶å¯ä»¥ä½¿ç”¨ä¼ å…¥ç»„ä»¶çš„å¼•ç”¨ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥ä½¿ç”¨ä¼ å…¥ç»„ä»¶çš„stateã€propsã€ç”Ÿå‘½å‘¨æœŸå’Œrenderæ–¹æ³•ã€‚

å®ƒæœ‰ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„ç‰¹ç‚¹ã€‚

- æ¸²æŸ“åŠ«æŒ

æ¸²æŸ“åŠ«æŒå°±æ˜¯æŒ‡é«˜é˜¶ç»„ä»¶å¯ä»¥æ§åˆ¶ä¼ å…¥ç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œå¹¶æ¸²æŸ“å„ç§å„æ ·çš„ç»“æœã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥å¯¹è¾“å‡ºçš„ç»“æœè¿›è¡Œè¯»å–ã€å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤propsï¼Œæˆ–è¯»å–æˆ–ä¿®æ”¹Reactå…ƒç´ æ ‘ï¼Œæˆ–æ¡ä»¶æ˜¾ç¤ºå…ƒç´ æ ‘ï¼Œåˆæˆ–æ˜¯ç”¨æ ·å¼æ§åˆ¶åŒ…è£¹å…ƒç´ æ ‘ã€‚

```
const MyContainer = (WrappedComponent) = > class extends WrappedComponent{
	render(){
		const elementsTree = super.render();
		let newProps={};
		if(elementsTree && elementsTree.type === 'input'){
			newProps = {value:'may the force be with you'};
		}
		const props =  Object.assign({},elementsTree.props,newProps);
		const newElmentsTree = React.cloneElement(elementsTree, props, elmentsTree.props.children);
		
	}
}
```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒWrappedComponentçš„æ¸²æŸ“ç»“æœä¸­ï¼Œé¡¶å±‚çš„inputç»„ä»¶çš„valueè¢«æ”¹å†™æˆmay the force be with youã€‚å› ä¸ºï¼Œæˆ‘ä»¬åœ¨é«˜é˜¶å‡½æ•°çš„åå‘ç»§æ‰¿å®ç°ä¸­å¯ä»¥ç¿»è½¬å…ƒç´ æ ‘ï¼Œæ”¹å˜å…ƒç´ æ ‘ä¸­çš„propsã€‚

- æ§åˆ¶state

é«˜é˜¶ç»„ä»¶å¯ä»¥è¯»å–ã€ä¿®æ”¹æˆ–åˆ é™¤WrappedComponentå®ä¾‹ä¸­çš„stateï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œä¹Ÿå¯ä»¥å¢åŠ stateã€‚ä½†è¿™æ ·åšï¼Œä¼šä½¿ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€æ··ä¹±ã€‚å¤§éƒ¨åˆ†é«˜é˜¶ç»„ä»¶éƒ½åº”è¯¥é™åˆ¶è¯»å–æˆ–å¢åŠ stateï¼Œå°¤å…¶æ˜¯åè€…ï¼Œå¯ä»¥é€šè¿‡é‡æ–°å‘½åstateï¼Œä»¥é˜²æ­¢æ··æ·†ã€‚

### ä¸‰ã€é¢å¤–çš„æ³¨æ„ç‚¹

1. ç»„ä»¶å‘½å

å½“åŒ…è£¹ä¸€ä¸ªé«˜é˜¶ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å¤±å»äº†åŸå§‹WrappedComponentsçš„displayNameï¼Œè€Œç»„ä»¶åå­—æ˜¯æ–¹ä¾¿æˆ‘ä»¬å¼€å‘ä¸è°ƒè¯•çš„é‡è¦å±æ€§ã€‚

æˆ‘ä»¬å‚è€ƒ react-reduxåº“ä¸­çš„å®ç°ï¼š

```
class HOC extends ...{
 static displayName = `HOC(${getDisplayName(WrappedComponent)})`;
}
//getDisplayNameæ–¹æ³•å¯ä»¥è¿™æ ·å®ç°ï¼š
function getDisplayNameï¼ˆWrappedComponent){
	return WrappedComponent.displayName || 
			WrappedComponent.name ||
			'Component';
}
```
æˆ–è€…å¯ä»¥ä½¿ç”¨recomposeåº“ï¼Œä»–å·²ç»å¸®æˆ‘ä»¬å®ç°äº†å¯¹åº”çš„æ–¹æ³•ã€‚

2. ç»„ä»¶å‚æ•°

è¿™å°±æ˜¯ä¸€å¼€å§‹æˆ‘æåˆ°è¿‡çš„ä¸€ç‚¹ï¼Œå¦‚ä½•é€šè¿‡æŸ¯é‡ŒåŒ–æ„å»ºæ›´åŠ ç²¾ç¡®çš„é«˜é˜¶ç»„ä»¶

```
function HOCFactoryFactory(...params){
	//å¯ä»¥åšä¸€äº›æ”¹å˜paramsçš„äº‹æƒ…
	return class HOCFactory(WrappedComponent){
		remder(){
			return <WrappedComponent {...this.props} />
		}
	}
}
```

å½“æˆ‘ä»¬ä½¿ç”¨æ—¶ï¼Œé€šè¿‡ä¸¤æ¬¡ä¼ å‚æ„å»ºæ›´ä¸ºç²¾å‡†çš„é«˜é˜¶ç»„ä»¶

`HOCFactoryFactory(params)(WrappedComponent)`

è¿™ä¹Ÿæ˜¯åˆ©ç”¨äº†å‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹æ€§ã€‚

### å››ã€æ€»ç»“å’Œå»ºè®®

- ç¬¬ä¸€æ¬¡çœ‹åˆ°`HOC`è¿™ä¸ªæ¦‚å¿µï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†äººæ˜¯æ‡µé€¼çš„ï¼Œè¢«è¿™ä¸ªåè¯å“åˆ°äº†ï¼Œä»¥ä¸ºå®ƒæ˜¯å¾ˆéš¾å¾—ï¼Œæˆ‘ä¹Ÿä¸è®¤ä¸ºåœ¨ä½ æ²¡æœ‰è¿ç”¨HOCä¹‹å‰åˆæ¬¡çœ‹å®Œè¿™ç¯‡æ–‡ç« å°±èƒ½å¤Ÿæ‹¨äº‘è§æ—¥ã€‚
- å¸æ”¶`HOC`æœ€å¥½çš„æ—¶æœºæ˜¯ï¼Œå½“ä½ çš„ç»„ä»¶ä»£ç çš„å¤ç”¨æ€§å‡ºç°é—®é¢˜ï¼Œå‡ºç°äº†å¤§é‡æ²¡å¿…è¦çš„å†—ä½™å¯å¤ç”¨åŠŸèƒ½æ€§ä»£ç æ—¶å€™ï¼Œä½ å°±å¯ä»¥åè¿‡æ¥çœ‹çœ‹`HOC`ï¼Œä¸€æ®µè¹©è„šçš„è‹±æ–‡ *when need nowï¼Œthe best time*ã€‚
- é«˜é˜¶ç»„ä»¶çš„å‡ºç°ï¼Œä»£è¡¨äº†reactå£°æ˜å¼ç¼–ç¨‹çš„æ€æƒ³æ–¹å‘ï¼Œæˆ‘ä»¬é€šè¿‡ç»„å»ºç»„åˆå¼€å‘ï¼Œé™ä½äº†ç»„ä»¶çš„å¤æ‚åº¦ï¼Œä¹Ÿè¾¾åˆ°äº†ä»£ç æ›´å¤§çš„å¤ç”¨åº¦ã€‚




